pipeline {
    agent {
        label 'zip-job-docker'
	    privileged true
      
    }
    stages{
        stage('Build') {
            steps {
                sh '/tmp/zip_job.py'
            }
        }
	      stage('Upload') {
	          when {
	              success
            }
	          steps {
                def server = Artifactory.server 'http://localhost:8082/'
                def rtDeployer = Artifactory.newDeployer(server: server)
                rtDeployer.deployable.pattern = '/tmp/*.zip'
                rtDeployer.rtDeployer.repository.repokey = 'binary-storage/1.2.0'
                rtDeployer.rtDeployer.deployIvy = true
                rtDeployer.deploy
 	          }
	      }
	      stage('Report') {
            steps {
                def buildstatus = currentBuild.currentResault
                emailext(attachLog: true, body: 'Job status mail body. ', subject: 'Job status mail subject is ${buildstatus}', to: 'lielyaakobov123@gmail.com')
            }
	      }
	      stage('Cleanup') {
            steps {
                deleteDir()
            }
        }
    }
}
